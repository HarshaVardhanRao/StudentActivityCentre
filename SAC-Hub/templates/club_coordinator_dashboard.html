{% extends 'base.html' %}
{% load static %}

{% block title %}Club Coordinator Dashboard - MITS SAC Hub{% endblock %}

{% block content %}
<!-- Coordinator Welcome Section -->
<div class="dashboard-welcome">
    <h1>Welcome, Coordinator {{ user.get_full_name|default:user.username }}! ü§ù</h1>
    <p>Bridge the gap between leadership and execution. Coordinate activities, support presidents, and ensure smooth operations across all club functions.</p>
</div>

<!-- Coordinator Key Metrics -->
<div class="stats-showcase">
    <div class="stat-card">
        <h3>Active Projects</h3>
        <div class="number">{{ active_projects|default:8 }}</div>
        <div class="label">Currently Managing</div>
    </div>
    <div class="stat-card">
        <h3>Events Coordinated</h3>
        <div class="number">{{ events_coordinated|default:24 }}</div>
        <div class="label">This Semester</div>
    </div>
    <div class="stat-card">
        <h3>Team Collaborations</h3>
        <div class="number">{{ team_collaborations|default:12 }}</div>
        <div class="label">Cross-Club Projects</div>
    </div>
    <div class="stat-card">
        <h3>Efficiency Rating</h3>
        <div class="number">{{ efficiency_rating|default:4.6 }}</div>
        <div class="label">Team Feedback</div>
    </div>
</div>

<!-- Coordination Tools -->
<div class="card-grid">
    <!-- Project Management -->
    <div class="feature-card">
        <div class="feature-card-header">
            <span class="feature-card-icon">üìã</span>
            <h3>Project Management</h3>
        </div>
        <div class="feature-card-body">
            <p>Track project progress, assign tasks, and coordinate with team members to ensure timely delivery.</p>
            <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                <a href="/coordinator/projects/" class="btn btn-primary" style="flex: 1;">View Projects</a>
                <a href="/coordinator/tasks/" class="btn btn-outline" style="flex: 1;">Manage Tasks</a>
            </div>
        </div>
    </div>

    <!-- Event Coordination -->
    <div class="feature-card">
        <div class="feature-card-header">
            <span class="feature-card-icon">üé™</span>
            <h3>Event Coordination</h3>
        </div>
        <div class="feature-card-body">
            <p>Organize logistics, coordinate with vendors, and ensure successful event execution from planning to completion.</p>
            <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                <a href="/coordinator/events/" class="btn btn-success" style="flex: 1;">Event Pipeline</a>
                <a href="/coordinator/logistics/" class="btn btn-outline" style="flex: 1;">Logistics</a>
            </div>
        </div>
    </div>

    <!-- Team Collaboration -->
    <div class="feature-card">
        <div class="feature-card-header">
            <span class="feature-card-icon">üë•</span>
            <h3>Team Collaboration</h3>
        </div>
        <div class="feature-card-body">
            <p>Facilitate communication between different teams, manage volunteer coordination, and maintain team synergy.</p>
            <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                <a href="/coordinator/teams/" class="btn btn-accent" style="flex: 1;">Team Hub</a>
                <a href="/coordinator/volunteers/" class="btn btn-outline" style="flex: 1;">Volunteers</a>
            </div>
        </div>
    </div>

    <!-- Resource Coordination -->
    <div class="feature-card">
        <div class="feature-card-header">
            <span class="feature-card-icon">üèóÔ∏è</span>
            <h3>Resource Coordination</h3>
        </div>
        <div class="feature-card-body">
            <p>Manage resource allocation, coordinate equipment sharing, and optimize resource utilization across clubs.</p>
            <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                <a href="/coordinator/resources/" class="btn btn-primary" style="flex: 1;">Resource Pool</a>
                <a href="/coordinator/equipment/" class="btn btn-outline" style="flex: 1;">Equipment</a>
            </div>
        </div>
    </div>
</div>

<!-- Active Projects & Tasks -->
<div class="interactive-section">
    <div class="section-header">
        <h2>Active Projects & Tasks</h2>
        <p>Monitor ongoing projects and coordinate task completion across teams</p>
    </div>

    {% if active_projects_list %}
    <div class="modern-table">
        <table>
            <thead>
                <tr>
                    <th>Project Name</th>
                    <th>Club/Team</th>
                    <th>Progress</th>
                    <th>Deadline</th>
                    <th>Priority</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for project in active_projects_list %}
                <tr>
                    <td><strong>{{ project.name }}</strong></td>
                    <td>{{ project.club.name }}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="flex: 1; background: var(--surface-tertiary); height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="background: var(--accent-emerald); height: 100%; width: {{ project.progress|default:60 }}%; transition: width 0.3s ease;"></div>
                            </div>
                            <span style="font-size: 0.875rem; color: var(--text-secondary);">{{ project.progress|default:60 }}%</span>
                        </div>
                    </td>
                    <td>{{ project.deadline|date:"M d, Y" }}</td>
                    <td>
                        {% if project.priority == 'HIGH' %}
                            <span class="status-badge status-error">High</span>
                        {% elif project.priority == 'MEDIUM' %}
                            <span class="status-badge status-warning">Medium</span>
                        {% else %}
                            <span class="status-badge status-success">Low</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if project.status == 'ON_TRACK' %}
                            <span class="status-badge status-success">On Track</span>
                        {% elif project.status == 'DELAYED' %}
                            <span class="status-badge status-warning">Delayed</span>
                        {% elif project.status == 'AT_RISK' %}
                            <span class="status-badge status-error">At Risk</span>
                        {% else %}
                            <span class="status-badge">{{ project.status }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="/coordinator/project/{{ project.id }}/" class="btn btn-primary" style="padding: 0.5rem; font-size: 0.75rem;">Manage</a>
                            <a href="/coordinator/project/{{ project.id }}/edit/" class="btn btn-outline" style="padding: 0.5rem; font-size: 0.75rem;">Edit</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <h3>Ready for New Projects! üöÄ</h3>
        <p>No active projects at the moment. Start coordinating new initiatives with your teams!</p>
        <a href="/coordinator/projects/create/" class="btn btn-primary">Create Project</a>
    </div>
    {% endif %}
</div>

<!-- Coordination Insights -->
<div class="interactive-section">
    <div class="section-header">
        <h2>Coordination Insights</h2>
        <p>Analytics and insights to help you coordinate more effectively</p>
    </div>
    
    <div class="card-grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
        <div class="feature-card">
            <div class="feature-card-header">
                <span class="feature-card-icon">‚ö°</span>
                <h3>Task Completion Rate</h3>
            </div>
            <div class="feature-card-body">
                <div style="font-size: 2.5rem; font-weight: 700; color: var(--accent-emerald); margin-bottom: 0.5rem;">
                    {{ task_completion_rate|default:87 }}%
                </div>
                <p style="margin-bottom: 1rem;">Tasks completed on time</p>
                <div style="background: var(--surface-tertiary); height: 8px; border-radius: 4px; overflow: hidden;">
                    <div style="background: linear-gradient(90deg, var(--accent-emerald), #48bb78); height: 100%; width: {{ task_completion_rate|default:87 }}%; border-radius: 4px; transition: width 1s ease;"></div>
                </div>
                <small style="color: var(--text-muted); margin-top: 0.5rem; display: block;">Above team average</small>
            </div>
        </div>

        <div class="feature-card">
            <div class="feature-card-header">
                <span class="feature-card-icon">üéØ</span>
                <h3>Project Success Rate</h3>
            </div>
            <div class="feature-card-body">
                <div style="font-size: 2.5rem; font-weight: 700; color: var(--primary-main); margin-bottom: 0.5rem;">
                    {{ project_success_rate|default:94 }}%
                </div>
                <p style="margin-bottom: 1rem;">Projects delivered successfully</p>
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                    <span style="color: var(--accent-emerald); font-size: 0.875rem;">‚ÜóÔ∏è +8%</span>
                    <span style="color: var(--text-muted); font-size: 0.875rem;">from last semester</span>
                </div>
            </div>
        </div>

        <div class="feature-card">
            <div class="feature-card-header">
                <span class="feature-card-icon">üë´</span>
                <h3>Team Satisfaction</h3>
            </div>
            <div class="feature-card-body">
                <div style="font-size: 2.5rem; font-weight: 700; color: var(--accent-gold); margin-bottom: 0.5rem;">
                    {{ team_satisfaction|default:4.6 }}/5
                </div>
                <p style="margin-bottom: 1rem;">Team member feedback rating</p>
                <div style="display: flex; justify-content: center; gap: 0.25rem; margin-top: 0.5rem;">
                    {% for i in "12345"|make_list %}
                        <span style="color: var(--accent-gold); font-size: 1.125rem;">‚≠ê</span>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Coordinator Toolkit -->
<div class="interactive-section">
    <div class="section-header">
        <h2>Coordinator Toolkit</h2>
        <p>Essential tools and resources for effective coordination</p>
    </div>
    
    <div class="card-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <div style="background: var(--surface-primary); padding: 1.5rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-md); text-align: center; border-left: 4px solid var(--primary-main);">
            <div style="font-size: 2rem; margin-bottom: 0.75rem;">üìä</div>
            <h4 style="margin-bottom: 0.5rem; color: var(--text-primary);">Progress Tracking</h4>
            <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 1rem;">Monitor project milestones and team performance metrics</p>
            <a href="/coordinator/tracking/" class="btn btn-outline" style="width: 100%; padding: 0.75rem;">Track Progress</a>
        </div>

        <div style="background: var(--surface-primary); padding: 1.5rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-md); text-align: center; border-left: 4px solid var(--accent-emerald);">
            <div style="font-size: 2rem; margin-bottom: 0.75rem;">üí¨</div>
            <h4 style="margin-bottom: 0.5rem; color: var(--text-primary);">Team Communication</h4>
            <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 1rem;">Facilitate seamless communication across all team members</p>
            <a href="/coordinator/communication/" class="btn btn-outline" style="width: 100%; padding: 0.75rem;">Manage Comms</a>
        </div>

        <div style="background: var(--surface-primary); padding: 1.5rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-md); text-align: center; border-left: 4px solid var(--accent-gold);">
            <div style="font-size: 2rem; margin-bottom: 0.75rem;">üìÖ</div>
            <h4 style="margin-bottom: 0.5rem; color: var(--text-primary);">Schedule Coordination</h4>
            <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 1rem;">Coordinate schedules and manage meeting arrangements</p>
            <a href="/coordinator/schedule/" class="btn btn-outline" style="width: 100%; padding: 0.75rem;">Manage Schedule</a>
        </div>

        <div style="background: var(--surface-primary); padding: 1.5rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-md); text-align: center; border-left: 4px solid var(--info);">
            <div style="font-size: 2rem; margin-bottom: 0.75rem;">üìã</div>
            <h4 style="margin-bottom: 0.5rem; color: var(--text-primary);">Task Assignment</h4>
            <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 1rem;">Efficiently assign and track task completion</p>
            <a href="/coordinator/assign/" class="btn btn-outline" style="width: 100%; padding: 0.75rem;">Assign Tasks</a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animate progress bars with different delays
    setTimeout(() => {
        const progressBars = document.querySelectorAll('[style*="width:"][style*="%"]');
        progressBars.forEach((bar, index) => {
            const width = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = width;
            }, 200 * (index + 1));
        });
    }, 500);

    // Add priority-based styling to project rows
    document.querySelectorAll('.status-badge.status-error').forEach(badge => {
        const row = badge.closest('tr');
        if (badge.textContent.trim() === 'High' && row) {
            row.style.borderLeft = '3px solid var(--error)';
            row.style.background = 'rgba(245, 101, 101, 0.02)';
        }
    });

    // Enhanced project management interactions
    const projectButtons = document.querySelectorAll('a[href*="/project/"]');
    projectButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            const projectRow = this.closest('tr');
            if (projectRow) {
                projectRow.style.background = 'var(--surface-secondary)';
                setTimeout(() => {
                    projectRow.style.background = '';
                }, 300);
            }
        });
    });

    // Real-time progress updates (simulation)
    setInterval(() => {
        const progressBars = document.querySelectorAll('[style*="width:"][style*="%"]');
        progressBars.forEach(bar => {
            const currentWidth = parseInt(bar.style.width);
            if (currentWidth < 100) {
                // Simulate small progress increments
                const newWidth = Math.min(100, currentWidth + Math.random() * 2);
                bar.style.width = newWidth + '%';
                const percentageSpan = bar.parentElement.querySelector('span');
                if (percentageSpan) {
                    percentageSpan.textContent = Math.round(newWidth) + '%';
                }
            }
        });
    }, 30000); // Update every 30 seconds
});
</script>
{% endblock %}
