{% extends 'base.html' %}

{% block title %}{{ club.name }} - MITS SAC Hub{% endblock %}

{% block description %}{{ club.description|default:"Learn more about this student club at MITS. Join activities, meet like-minded peers, and grow your skills." }}{% endblock %}

{% block content %}
<!-- Club Hero Section -->
<div class="club-hero" style="background: linear-gradient(135deg, var(--primary-deep) 0%, var(--accent-emerald) 100%); color: var(--text-inverse); padding: 4rem 0; border-radius: var(--radius-xl); margin-bottom: 3rem; position: relative; overflow: hidden;">
    <div style="position: absolute; top: -20%; right: -10%; width: 400px; height: 400px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
    <div style="position: absolute; bottom: -20%; left: -10%; width: 500px; height: 500px; background: radial-gradient(circle, rgba(214,158,46,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
    
    <div class="container" style="position: relative; z-index: 2;">
        <div style="display: grid; grid-template-columns: 1fr auto; gap: 2rem; align-items: center;">
            <div>
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <span style="background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: var(--radius-full); font-size: 0.875rem; font-weight: 600;">
                        Student Club
                    </span>
                    <div class="status-badge" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; font-size: 0.75rem; font-weight: 600; border-radius: 9999px; background: rgba(255,255,255,0.2);">
                        <span style="width: 8px; height: 8px; background: #4ade80; border-radius: 50%;"></span>
                        Active
                    </div>
                </div>
                
                <h1 style="font-size: 3.5rem; font-weight: 800; margin-bottom: 1rem; line-height: 1.1;">
                    {{ club.name }}
                </h1>
                
                <p style="font-size: 1.25rem; opacity: 0.9; line-height: 1.6; margin-bottom: 2rem; max-width: 600px;">
                    {{ club.description|default:"A vibrant student community fostering growth, collaboration, and meaningful connections through engaging activities and shared experiences." }}
                </p>
                
                <!-- Club Stats -->
                <div style="display: flex; gap: 3rem; margin-bottom: 2rem;">
                    <div style="text-align: center;">
                        <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.25rem;">{{ club.members.count }}</div>
                        <div style="font-size: 0.875rem; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px;">Members</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.25rem;">{{ club.events.count }}</div>
                        <div style="font-size: 0.875rem; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px;">Events</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.25rem;">{{ club.coordinators.count }}</div>
                        <div style="font-size: 0.875rem; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px;">Coordinators</div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                {% if user.is_authenticated %}
                    {% if user in club.members.all %}
                    <a href="{% url 'club_leave' club.id %}" onclick="return confirm('Are you sure you want to leave {{ club.name }}?')" style="background: rgba(255,255,255,0.2); color: var(--text-inverse); padding: 1rem 2rem; border-radius: var(--radius-lg); text-decoration: none; font-weight: 600; text-align: center; transition: var(--transition-normal); border: 2px solid rgba(255,255,255,0.3);">
                        ‚úì Leave Club
                    </a>
                    {% else %}
                    <a href="{% url 'club_join' club.id %}" onclick="return confirm('Join {{ club.name }}?')" style="background: var(--accent-gold); color: var(--text-inverse); padding: 1rem 2rem; border-radius: var(--radius-lg); text-decoration: none; font-weight: 600; text-align: center; transition: var(--transition-normal); box-shadow: var(--shadow-lg);">
                        üéØ Join Club
                    </a>
                    {% endif %}
                {% endif %}
                
                {% if user.is_authenticated and (user in club.coordinators.all or 'ADMIN' in user.roles) %}
                <a href="{% url 'club_edit' club.id %}" style="background: rgba(255,255,255,0.2); color: var(--text-inverse); padding: 1rem 2rem; border-radius: var(--radius-lg); text-decoration: none; font-weight: 600; text-align: center; transition: var(--transition-normal); border: 2px solid rgba(255,255,255,0.3);">
                    ‚öôÔ∏è Edit Club
                </a>
                {% endif %}
                
                <a href="{% url 'club_list' %}" style="background: transparent; color: var(--text-inverse); padding: 1rem 2rem; border-radius: var(--radius-lg); text-decoration: none; font-weight: 500; text-align: center; transition: var(--transition-normal); border: 2px solid rgba(255,255,255,0.3);">
                    ‚Üê Back to Clubs
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 3rem;">
        <!-- Main Content -->
        <div>
            <!-- Club Description -->
            {% if club.description %}
            <section class="content-section" style="background: var(--surface-primary); border-radius: var(--radius-xl); padding: 3rem; margin-bottom: 3rem; box-shadow: var(--shadow-md); border: 1px solid rgba(0,0,0,0.05);">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                    <div style="width: 4px; height: 40px; background: linear-gradient(var(--primary-main), var(--accent-emerald)); border-radius: 2px;"></div>
                    <h2 style="font-size: 2rem; font-weight: 700; color: var(--text-primary);">About This Club</h2>
                </div>
                <div style="color: var(--text-secondary); font-size: 1.125rem; line-height: 1.8;">
                    <p>{{ club.description }}</p>
                </div>
            </section>
            {% endif %}
            
            <!-- Recent Events -->
            {% if recent_events %}
            <section class="content-section" style="background: var(--surface-primary); border-radius: var(--radius-xl); padding: 3rem; margin-bottom: 3rem; box-shadow: var(--shadow-md); border: 1px solid rgba(0,0,0,0.05);">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 4px; height: 40px; background: linear-gradient(var(--accent-gold), var(--accent-emerald)); border-radius: 2px;"></div>
                        <h2 style="font-size: 2rem; font-weight: 700; color: var(--text-primary);">Recent Events</h2>
                    </div>
                    <a href="{% url 'event_list' %}" style="color: var(--primary-main); font-weight: 600; text-decoration: none;">View All ‚Üí</a>
                </div>
                
                <div style="display: grid; gap: 1.5rem;">
                    {% for event in recent_events %}
                    <div style="background: var(--surface-secondary); border-radius: var(--radius-lg); padding: 1.5rem; border: 1px solid rgba(0,0,0,0.03); transition: var(--transition-normal);" onmouseover="this.style.background='var(--surface-tertiary)'" onmouseout="this.style.background='var(--surface-secondary)'">
                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem;">
                            <div style="flex: 1;">
                                <h4 style="font-size: 1.25rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    {{ event.title }}
                                </h4>
                                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem; line-height: 1.5;">
                                    {{ event.description|truncatewords:20 }}
                                </p>
                                <div style="display: flex; gap: 1.5rem; font-size: 0.875rem; color: var(--text-muted);">
                                    <span>üìÖ {{ event.date_time|date:"M j, Y" }}</span>
                                    <span>üïí {{ event.date_time|time:"g:i A" }}</span>
                                    {% if event.venue %}<span>üìç {{ event.venue }}</span>{% endif %}
                                </div>
                            </div>
                            <a href="{% url 'event_detail' event.id %}" style="background: var(--primary-main); color: var(--text-inverse); padding: 0.5rem 1rem; border-radius: var(--radius-md); text-decoration: none; font-size: 0.875rem; font-weight: 500; white-space: nowrap;">
                                View Event
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}
        </div>
        
        <!-- Sidebar -->
        <div>
            <!-- Club Leadership -->
            <section class="sidebar-section" style="background: var(--surface-primary); border-radius: var(--radius-xl); padding: 2rem; margin-bottom: 2rem; box-shadow: var(--shadow-md); border: 1px solid rgba(0,0,0,0.05);">
                <h3 style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                    üë• Leadership Team
                </h3>
                
                {% if club.advisor %}
                <div style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--surface-tertiary);">
                    <h4 style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Faculty Advisor</h4>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 40px; height: 40px; background: var(--accent-emerald); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.2rem;">
                            {{ club.advisor.first_name.0|default:club.advisor.username.0 }}
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary);">{{ club.advisor.get_full_name|default:club.advisor.username }}</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">{{ club.advisor.email }}</div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% if club.coordinators.all %}
                <div>
                    <h4 style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 1rem;">Coordinators</h4>
                    <div style="display: grid; gap: 1rem;">
                        {% for coordinator in club.coordinators.all %}
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 36px; height: 36px; background: var(--primary-main); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 1rem;">
                                {{ coordinator.first_name.0|default:coordinator.username.0 }}
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 500; color: var(--text-primary); font-size: 0.95rem;">{{ coordinator.get_full_name|default:coordinator.username }}</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">{{ coordinator.email }}</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </section>
            
            <!-- Club Statistics -->
            <section class="sidebar-section" style="background: linear-gradient(135deg, var(--primary-main) 0%, var(--accent-royal) 100%); color: var(--text-inverse); border-radius: var(--radius-xl); padding: 2rem; margin-bottom: 2rem; box-shadow: var(--shadow-md); position: relative; overflow: hidden;">
                <div style="position: absolute; top: -10px; right: -10px; width: 60px; height: 60px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                
                <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; position: relative; z-index: 2;">
                    üìä Quick Stats
                </h3>
                
                <div style="display: grid; gap: 1rem; position: relative; z-index: 2;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: var(--radius-lg);">
                        <span style="font-weight: 500;">Total Members</span>
                        <span style="font-size: 1.5rem; font-weight: 700;">{{ club.members.count }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: var(--radius-lg);">
                        <span style="font-weight: 500;">Total Events</span>
                        <span style="font-size: 1.5rem; font-weight: 700;">{{ club.events.count }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: var(--radius-lg);">
                        <span style="font-weight: 500;">Founded</span>
                        <span style="font-size: 1rem; font-weight: 600;">{{ club.created_at|date:"Y" }}</span>
                    </div>
                </div>
            </section>
            
            <!-- Club Members -->
            {% if club.members.all %}
            <section class="sidebar-section" style="background: var(--surface-primary); border-radius: var(--radius-xl); padding: 2rem; box-shadow: var(--shadow-md); border: 1px solid rgba(0,0,0,0.05);">
                <h3 style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                    üéì Members
                </h3>
                
                <div style="display: grid; gap: 0.75rem; max-height: 300px; overflow-y: auto;">
                    {% for member in club.members.all|slice:":10" %}
                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; border-radius: var(--radius-md); transition: var(--transition-fast);" onmouseover="this.style.background='var(--surface-secondary)'" onmouseout="this.style.background='transparent'">
                        <div style="width: 32px; height: 32px; background: var(--accent-gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.875rem;">
                            {{ member.first_name.0|default:member.username.0 }}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: 500; color: var(--text-primary); font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                {{ member.get_full_name|default:member.username }}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    
                    {% if club.members.count > 10 %}
                    <div style="text-align: center; padding: 1rem; color: var(--text-muted); font-size: 0.875rem; font-weight: 500;">
                        +{{ club.members.count|add:"-10" }} more members
                    </div>
                    {% endif %}
                </div>
            </section>
            {% endif %}
        </div>
    </div>
</div>

<!-- Enhanced JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add smooth hover animations
    const hoverElements = document.querySelectorAll('.content-section, .sidebar-section');
    
    hoverElements.forEach(element => {
        element.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = 'var(--shadow-lg)';
        });
        
        element.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'var(--shadow-md)';
        });
    });
    
    // Animate stats on scroll
    const observerOptions = {
        threshold: 0.5,
        rootMargin: '0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const numbers = entry.target.querySelectorAll('[style*="font-size: 2.5rem"]');
                numbers.forEach(number => {
                    const finalValue = parseInt(number.textContent);
                    let currentValue = 0;
                    const increment = Math.ceil(finalValue / 30);
                    
                    const timer = setInterval(() => {
                        currentValue += increment;
                        if (currentValue >= finalValue) {
                            currentValue = finalValue;
                            clearInterval(timer);
                        }
                        number.textContent = currentValue;
                    }, 50);
                });
            }
        });
    }, observerOptions);
    
    const clubHero = document.querySelector('.club-hero');
    if (clubHero) {
        observer.observe(clubHero);
    }
});
</script>

<style>
/* Responsive Design */
@media (max-width: 1024px) {
    .container > div {
        grid-template-columns: 1fr !important;
        gap: 2rem !important;
    }
    
    .club-hero .container > div {
        grid-template-columns: 1fr !important;
        text-align: center;
    }
    
    .club-hero .container > div > div:last-child {
        flex-direction: row !important;
        justify-content: center;
        flex-wrap: wrap;
    }
}

@media (max-width: 768px) {
    .club-hero {
        padding: 3rem 0 !important;
    }
    
    .club-hero h1 {
        font-size: 2.5rem !important;
    }
    
    .club-hero p {
        font-size: 1rem !important;
    }
    
    .club-hero > div > div > div:first-child > div:nth-child(4) {
        flex-direction: column !important;
        gap: 1rem !important;
    }
    
    .content-section,
    .sidebar-section {
        padding: 2rem !important;
    }
}

@media (max-width: 480px) {
    .club-hero {
        padding: 2rem 0 !important;
    }
    
    .club-hero h1 {
        font-size: 2rem !important;
    }
    
    .club-hero > div > div > div:last-child {
        flex-direction: column !important;
    }
    
    .content-section,
    .sidebar-section {
        padding: 1.5rem !important;
    }
}

/* Smooth animations */
.content-section,
.sidebar-section {
    transition: var(--transition-normal);
}

/* Custom scrollbar for members list */
.sidebar-section div[style*="overflow-y: auto"]::-webkit-scrollbar {
    width: 4px;
}

.sidebar-section div[style*="overflow-y: auto"]::-webkit-scrollbar-track {
    background: var(--surface-tertiary);
    border-radius: 2px;
}

.sidebar-section div[style*="overflow-y: auto"]::-webkit-scrollbar-thumb {
    background: var(--primary-main);
    border-radius: 2px;
}
</style>
{% endblock %}